{% extends "base.html" %}

{% block functions %}
  {{ block.super }}
  InstallFunction(server, 'AddProductToCart', false);

  function doAddProductToCart(product){
    server.AddProductToCart(product, updateCartWidget);    
  }

  function updateCartWidget(response){
    if(response["alert1"]){
       $("alert1").innerHTML = response["alert1"];
    }else{
       $("ShoppingCartCount").innerHTML = response["count"];
       $("checkout_button").style.display = 'inline';
    }
  }
{% endblock functions%}

{% block content %}
{% block catalog %}
	{% if products %}
	<table class="catalog">
    <tr>
	{% for product in products %}
	   {% if not forloop.first %} 
	   {% if forloop.counter0|divisibleby:"4" %}
	   </tr><tr>
	   {% endif %}
	   {% endif %}
       <td>
		 <div class="product_image_panel">
		   <a href="/product/{{product.maker.slug}}/{{product.slug}}"><img class="product_image" src="/images/{{product.image}}" alt="{{product.name}}" title="{{product.name}}"/></a>
         </div>

		 <span class="product_info_panel">
		   <p class="product_name">{% if maker %} {% ifequal product.maker.key maker.key %}(<a href="/product/edit/{{product.maker.slug}}/{{product.slug}}">edit</a>){% endifequal %}{% endif %} <span><a href="/product/{{product.maker.slug}}/{{product.slug}}">{{product.name}}</a></span></p>
		   <p class="store_name">by <a href="/maker_store/{{product.maker.slug}}">{{product.maker.store_name}}</a></p>
		   <span class="product_short_description">{{product.short_description}}</span>
		 </span>
		 <div class="product_price_panel">
		   <p>{{product.inventory}} remaining</p>
		   <p class="price">${{product.price|floatformat:2}} <input class="add_button" type="button" value="Add to Cart" onclick="doAddProductToCart('{{product.key}}')" /> </p>
		 </div>
	   </td>
    {% endfor %}
	</tr>
    </table>
	{% else %}
	   <p>No products found. Please check back soon.</p>
	{% endif %}
{% endblock catalog %}
{% endblock content  %}
