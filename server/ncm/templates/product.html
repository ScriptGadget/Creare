{% extends "base.html" %}
{% block functions %}
  function hide_show_inventory()
  {
	  inventory = $("id_inventory")
	  style = inventory.parentNode.parentNode.style;
	  if ($("id_unique").checked){
		  style.display = 'none';
		  inventory.value = 1
	  } else {
		  style.display = '';
	  }
  }

  function ajaxFileUpload(upload_field)
  {
	  // Checking file type
	  var re_text = /\.jpg|\.png|\.jpeg/i;
	  var filename = upload_field.value;
	  if (filename.search(re_text) == -1) {
		  alert("File should be either jpg or png or jpeg");
		  upload_field.form.reset();
		  return false;
	  }
	  document.getElementById('picture_preview').innerHTML = '<img src="/static/images/loading.gif" border="0" />';
	  upload_field.form.action = '/image/upload';
	  upload_field.form.target = 'upload_iframe';
	  upload_field.form.submit();
	  upload_field.form.action = '';
	  upload_field.form.target = '';
	  return true;
  }

  function submitProductForm(){
	  $('product_form').submit();
  }

  function tangram_init(){
	  hide_show_inventory();
	  $("id_unique").onclick = hide_show_inventory
  }

{% endblock functions%}

{% block content %}
    <div id="product_panel">
         <form id="product_form" enctype="multipart/form-data" action="{{ uri }}" method="POST">
		   <table>
		   {{ form.as_table }}
		   {{ tag_field }}
		   </table>
		   <input type="hidden" name="_id" value="{{ id }}">
		   {% if messages %}
		   <ul class="errorlist">
		   {% for message in messages %}
		   <li>{{message}}</li>
		   {% endfor %}
		   </ul>
		   {% endif %}
           <div id="picture_preview">{% if product %}<img src="/images/{{product.image}}" border="0" />{% endif %}</div>
         </form>

		 <iframe name="upload_iframe" id="upload_iframe" style="display:none;"></iframe>

		 <form name="pictureForm" method="post" autocomplete="off" enctype="multipart/form-data">
		   <div>
			 <span>Upload Picture :</span>
			 <input type="file" name="img" id="picture" onchange="return ajaxFileUpload(this);" />
			 <input type="hidden" name="parent_form" value="product_form" />
			   <input type="hidden" name="max_width" value={{max_width}} />
			   <input type="hidden" name="max_height" value={{max_height}} />
			   <input type="hidden" name="image_field" value="image_key" />
			 <span id="picture_error"></span>
		   </div>
		 </form>

           <div><input id="submit" class="button"  type="button" value="Save Changes" onclick="return submitProductForm()"/></div>

	</div>
{% endblock %}
